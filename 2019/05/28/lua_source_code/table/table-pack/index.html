<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=0.5"><link rel="stylesheet" href="/css/post.css"><link rel="icon" href="/img/favicon.png"><title>table.pack</title><meta name="generator" content="Hexo 6.0.0"></head><body>　　<div class="inner"><h2>table.pack</h2><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>lua库函数<strong>table.pack</strong>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">table</span>.pack(...)</span><br></pre></td></tr></table></figure>

<p><strong>table.pack</strong>的目的是返回所有参数以键$1,2,…,n$填充的新表，并将”n”这个域设置为参数的总数。注意，因为是按参数的逆序填充参数，所以导致这张返回的表不一定是一个序列。 <strong>table.pack</strong>的具体实现是C函数<strong>pack</strong>，接下来对<strong>pack</strong>进行分析。</p>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>对<strong>pack</strong>进行注解：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">pack</span> <span class="params">(lua_State *L)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="comment">// 获取参数数量n</span></span><br><span class="line">    <span class="type">int</span> n = lua_gettop(L);  <span class="comment">/* number of elements to pack */</span></span><br><span class="line">    <span class="comment">// 创建一个表,并且重设其大小</span></span><br><span class="line">    lua_createtable(L, n, <span class="number">1</span>);  <span class="comment">/* create result table */</span></span><br><span class="line">    <span class="comment">// 将这个表插入到 index 1</span></span><br><span class="line">    lua_insert(L, <span class="number">1</span>);  <span class="comment">/* put it at index 1 */</span></span><br><span class="line">    <span class="comment">// 将所有参数按倒序依次放入表中</span></span><br><span class="line">    <span class="comment">// 因为这里是按倒序将参数放入表中</span></span><br><span class="line">    <span class="comment">// 所以pack返回的表不一定是一个序列</span></span><br><span class="line">    <span class="keyword">for</span> (i = n; i &gt;= <span class="number">1</span>; i--) &#123; <span class="comment">/* assign elements */</span></span><br><span class="line">        lua_seti(L, <span class="number">1</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 往栈上压入n</span></span><br><span class="line">    lua_pushinteger(L, n);</span><br><span class="line">    <span class="comment">// 在表中设置t[&quot;n&quot;]=n</span></span><br><span class="line">    lua_setfield(L, <span class="number">1</span>, <span class="string">&quot;n&quot;</span>);  <span class="comment">/* t.n = number of elements */</span></span><br><span class="line">    <span class="comment">// 返回1表明，pack只有一个返回值</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;  <span class="comment">/* return table */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>pack</strong>的实现是比较简单的。现在对<strong>pack</strong>的时间复杂度和空间复杂度进行分析：</p>
<h6 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h6><p><strong>pack</strong>除for循环外，均是常量时间操作；for循环内部的lua_seti()也可认为是常量时间操作；所以<strong>pack</strong>的时间复杂度是： $$ O(n) $$</p>
<h6 id="空间复杂度"><a href="#空间复杂度" class="headerlink" title="空间复杂度"></a>空间复杂度</h6><p><strong>pack</strong>会在创建表时，设置其大小；最后会新增一个”n”域；表的大小是和参数数量成正比的；<strong>pack</strong>的空间复杂度是： $$ O(n) $$</p>
<h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><p><a target="_blank" rel="noopener" href="https://www.lua.org/manual/5.3/manual.html#pdf-table.pack"><strong>lua5.3参考手册之table.pack</strong></a></p>
<p><span></span><a href="/">返回首页</a><span></span></p></div><script src="/js/jquery.min.js"></script><script src="/js/main.js"></script></body></html>