<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=0.5"><link rel="stylesheet" href="/css/post.css"><link rel="icon" href="/img/favicon.png"><title>GCC内建的原子操作api</title><meta name="generator" content="Hexo 6.0.0"></head><body>　　<div class="inner"><h2>GCC内建的原子操作api</h2><h1 id="零、前言"><a href="#零、前言" class="headerlink" title="零、前言"></a>零、前言</h1><p>大名鼎鼎的<strong>GCC</strong>在glibc中，为原子操作提供了一系列<strong>built-in functions</strong>。这些函数以较底层的汇编代码编写，减轻了系统、应用级别的加锁带来的性能损耗。因为是内建的函数，在使用时不需要包含标准库的头文件；下面简单介绍这些函数。</p>
<h1 id="一、n-类操作"><a href="#一、n-类操作" class="headerlink" title="一、n++类操作"></a>一、n++类操作</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type __sync_fetch_and_add (type *ptr, type value, ...)</span><br><span class="line">type __sync_fetch_and_sub (type *ptr, type value, ...)</span><br><span class="line">type __sync_fetch_and_or (type *ptr, type value, ...)</span><br><span class="line">type __sync_fetch_and_and (type *ptr, type value, ...)</span><br><span class="line">type __sync_fetch_and_xor (type *ptr, type value, ...)</span><br><span class="line">type __sync_fetch_and_nand (type *ptr, type value, ...)</span><br></pre></td></tr></table></figure>

<p>上述函数用伪代码可以表示为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="comment">// add sub or and xor</span></span><br><span class="line">    tmp = *ptr; </span><br><span class="line">    *ptr op= value; <span class="comment">//op表示操作，比如+、-、&amp;、、^等</span></span><br><span class="line">    <span class="keyword">return</span> tmp; </span><br><span class="line">&#125;</span><br><span class="line">&#123; <span class="comment">// nand 即 not and，对and之后的值取反</span></span><br><span class="line">    tmp = *ptr; </span><br><span class="line">    *ptr = ~(tmp &amp; value); </span><br><span class="line">    <span class="keyword">return</span> tmp; </span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<p>对其一一说明：</p>
<ul>
<li><strong>__sync_fetch_and_add</strong>：原子加法，*ptr + value获得新值，但返回旧的*ptr；</li>
<li><strong>__sync_fetch_and_sub</strong>：原子减法，*ptr - value获得新值，但返回旧的*ptr；</li>
<li><strong>__sync_fetch_and_or</strong>：原子或运算，*ptr value获得新值，但返回旧的*ptr；</li>
<li><strong>__sync_fetch_and_and</strong>：原子与运算，*ptr &amp; value获得新值，但返回旧的*ptr;</li>
<li><strong>__sync_fetch_and_xor</strong>：原子亦或运算，*ptr ^ value获得新值，但返回旧的*ptr;</li>
<li><strong>__sync_fetch_and_nand</strong>：原子not and运算，先与运算再取反获得新值，但返回旧的*ptr。</li>
</ul>
<p>测试代码（非多线程环境，只是演示如何使用原子操作）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// __sync_fetch_and_add</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, __sync_fetch_and_add(&amp;a, <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// __sync_fetch_and_sub</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, __sync_fetch_and_sub(&amp;a, <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// __sync_fetch_and_or</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, __sync_fetch_and_or(&amp;a, <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// __sync_fetch_and_and</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, __sync_fetch_and_and(&amp;a, <span class="number">0</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// __sync_fetch_and_xor</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, __sync_fetch_and_xor(&amp;a, <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// __sync_fetch_and_nand</span></span><br><span class="line">    <span class="comment">// 1 &amp; 1 --&gt; 1</span></span><br><span class="line">    <span class="comment">// not 1 --&gt; 1111...1110</span></span><br><span class="line">    <span class="comment">// 最终得到-2</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, __sync_fetch_and_nand(&amp;a, <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="二、-n类操作"><a href="#二、-n类操作" class="headerlink" title="二、++n类操作"></a>二、++n类操作</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type __sync_add_and_fetch (type *ptr, type value, ...)</span><br><span class="line">type __sync_sub_and_fetch (type *ptr, type value, ...)</span><br><span class="line">type __sync_or_and_fetch (type *ptr, type value, ...)</span><br><span class="line">type __sync_and_and_fetch (type *ptr, type value, ...)</span><br><span class="line">type __sync_xor_and_fetch (type *ptr, type value, ...)</span><br><span class="line">type __sync_nand_and_fetch (type *ptr, type value, ...)</span><br></pre></td></tr></table></figure>

<p>上述函数用伪代码表示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="comment">// add sub or and xor nand</span></span><br><span class="line">    *ptr op= value; </span><br><span class="line">    <span class="keyword">return</span> *ptr; </span><br><span class="line">&#125;</span><br><span class="line">&#123;<span class="comment">// nand 即not and</span></span><br><span class="line">    *ptr = ~(*ptr &amp; value); </span><br><span class="line">    <span class="keyword">return</span> *ptr; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对其一一说明：</p>
<ul>
<li><strong>__sync_add_and_fetch</strong>：原子加法，*ptr + value获得新值，并返回新值；</li>
<li><strong>__sync_sub_and_fetch</strong>：原子减法，*ptr - value获得新值，并返回新值；</li>
<li><strong>__sync_or_and_fetch</strong>：原子或运算，*ptr value获得新值，并返回新值；</li>
<li><strong>__sync_and_and_fetch</strong>：原子与运算，*ptr &amp; value获得新值，并返回新值;</li>
<li><strong>__sync_xor_and_fetch</strong>：原子亦或运算，*ptr ^ value获得新值，并返回新值;</li>
<li><strong>__sync_nand_and_fetch</strong>：原子not and运算，先与运算再取反获得新值，并返回新值。</li>
</ul>
<p>测试代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// __sync_add_and_fetch</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, __sync_add_and_fetch(&amp;a, <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// __sync_sub_and_fetch</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, __sync_sub_and_fetch(&amp;a, <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// __sync_or_and_fetch</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, __sync_or_and_fetch(&amp;a, <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// __sync_and_and_fetch</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, __sync_and_and_fetch(&amp;a, <span class="number">0</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// __sync_xor_and_fetch</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, __sync_xor_and_fetch(&amp;a, <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// __sync_nand_and_fetch</span></span><br><span class="line">    <span class="comment">// 1 &amp; 1 --&gt; 1</span></span><br><span class="line">    <span class="comment">// not 1 --&gt; 1111...1110</span></span><br><span class="line">    <span class="comment">// 最终得到-2</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, __sync_nand_and_fetch(&amp;a, <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="三、CAS"><a href="#三、CAS" class="headerlink" title="三、CAS"></a>三、CAS</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> __sync_bool_compare_and_swap (type *ptr, type oldval type newval, ...)</span><br><span class="line">type __sync_val_compare_and_swap (type *ptr, type oldval type newval, ...)</span><br></pre></td></tr></table></figure>

<p>上述函数，执行原子的比较和交换（即<strong>CAS</strong>）：如果当前的*ptr等于oldval,则将newval写入到*ptr。 说明：</p>
<ul>
<li><strong>__sync_bool_compare_and_swap</strong>：返回真，如果比较成功，且newval被写入；</li>
<li><strong>__sync_val_compare_and_swap</strong>：返回进行CAS操作之前的*ptr。</li>
</ul>
<p>测试代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// a: 0 --&gt; 9(can)</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s &quot;</span>, __sync_bool_compare_and_swap(&amp;a, <span class="number">0</span>, <span class="number">9</span>) ? <span class="string">&quot;yes&quot;</span> : <span class="string">&quot;no&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line">    <span class="comment">//a: 9 --&gt; 0 (can not, 因为a != 5)</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s &quot;</span>, __sync_bool_compare_and_swap(&amp;a, <span class="number">5</span>, <span class="number">0</span>) ? <span class="string">&quot;yes&quot;</span> : <span class="string">&quot;no&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    a = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// success</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;old:%d &quot;</span>, __sync_val_compare_and_swap(&amp;a, <span class="number">0</span>, <span class="number">9</span>)); </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;new:%d\n&quot;</span>, a);</span><br><span class="line">    <span class="comment">// fail,因为a != 5</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;old:%d &quot;</span>, __sync_val_compare_and_swap(&amp;a, <span class="number">5</span>, <span class="number">0</span>)); </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;new:%d\n&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="四、lock-test-and-set"><a href="#四、lock-test-and-set" class="headerlink" title="四、lock_test_and_set"></a>四、lock_test_and_set</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type __sync_lock_test_and_set (type *ptr, type value, ...)</span><br></pre></td></tr></table></figure>

<p><strong>__sync_lock_test_and_set</strong>将value写入*ptr，返回旧的*ptr。 测试代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// a:0 --&gt; 6</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, __sync_lock_test_and_set(&amp;a, <span class="number">6</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="五、lock-release"><a href="#五、lock-release" class="headerlink" title="五、lock_release"></a>五、lock_release</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __sync_lock_release (type *ptr, ...)</span><br></pre></td></tr></table></figure>

<p><strong>__sync_lock_release</strong>可以释放<strong>__sync_lock_test_and_set</strong>获得的锁。一般将0写入*ptr。 测试代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// a:0 --&gt; 6</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, __sync_lock_test_and_set(&amp;a, <span class="number">6</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line">    <span class="comment">// release </span></span><br><span class="line">    __sync_lock_release(&amp;a);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><p>上文提到的原子操作在新的标准库版本中支持C++11的内存模型。 上文提到的原子操作在较新的版本中，前缀由<strong>__sync</strong>变更为<strong>__atomic</strong>，并且去掉了中间的and，比如<strong>__sync_fetch_and_add</strong>变为<strong>__atomic_fetch_add</strong>；并且在使用上有细微差别。 上文提到的原子操作支持大小为1,2,4或者8字节的完整的变量和指针（如果__int128被支持，原子操作可以支持16字节的变量）。 上文提供的测试代码，请使用gcc进行编译。 在<strong>gcc4.4</strong>之前的版本，<strong>__sync_fetch_and_nand</strong>是先对*ptr的tmp值取反，再执行与运算（步骤是相反的）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="comment">// GCC4.4之前 nand 即 not and</span></span><br><span class="line">    tmp = *ptr; </span><br><span class="line">    *ptr = ~tmp &amp; value;<span class="comment">// 先取反，再求与 </span></span><br><span class="line">    <span class="keyword">return</span> tmp; </span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<p>在<strong>gcc4.4</strong>之前的版本，<strong>__sync_nand_and_fetch</strong>是先对*ptr的tmp值取反，再执行与运算（步骤是相反的）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="comment">// GCC4.4之前 nand 即 not and</span></span><br><span class="line">    *ptr = ~*ptr &amp; value;<span class="comment">// 先取反，再求与 </span></span><br><span class="line">    <span class="keyword">return</span> *ptr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><p><a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/gcc-9.1.0/gcc/_005f_005fatomic-Builtins.html#g_t_005f_005fatomic-Builtins"><strong>GCC原子操作说明文档</strong></a></p>
<p><span></span><a href="/">返回首页</a><span></span></p></div><script src="/js/jquery.min.js"></script><script src="/js/main.js"></script></body></html>